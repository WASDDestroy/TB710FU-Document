# 刷机指南：用户操作

## 一、刷机软件"匣"的详细操作指南

### 1.1 软件安装与准备

1. **下载软件**：从群文件"搞机工具"文件夹下载`匣(0.4.2.0913-B).zip`
2. **解压文件**：解压到任意文件夹，例如`D:\刷机工具\`
3. **运行软件**：双击`GeekFlashTool.exe`启动程序
4. **安装驱动**（首次使用必须）：
   - 点击主界面"通用功能"区域的"安装刷机驱动"按钮
   - 安装完成后**必须重启电脑**
5. **安装LibUSB驱动**（可选但推荐）：
   - 软件启动时会提示安装，点击确认安装
   - 避免每次启动时的弹窗提醒

### 1.2 进入9008刷机模式

1. **打开刷机界面**：
   - 点击左侧导航栏"QC/高通"
   - 点击下方的"深度刷机"选项
2. **选择引导文件**：
   - 点击顶部"选择设备/引导/配置"按钮
   - 在弹出的窗口中，点击"引导文件"右侧的"..."按钮
   - 选择从群文件"神秘引导文件"下载的`xbl_s_devprg_ns.melf`
   - 点击蓝色"确定"按钮
3. **连接设备**：
   - 确保平板已进入9008模式（方法见后文）
   - 软件会自动检测设备，部分情况需要手动选择COM端口

### 1.3 界面功能详解

**主操作区各按钮功能：**

| 按钮/功能  | 具体作用            | 注意事项                      |
| ------ | --------------- | ------------------------- |
| 读信息    | 读取设备分区信息        | 先执行此操作才能看到分区列表            |
| 刷入     | 将选定的镜像写入设备      | 刷写前必须勾选对应分区               |
| 回读     | 从设备读取分区到电脑      | 可用于备份，会覆盖选定的文件            |
| 擦除     | 清除分区数据          | 谨慎使用，可能清除重要数据             |
| 恢复出厂设置 | 重启到Recovery执行清除 | 选择"通用"选项                  |
| 重启     | 重启设备到不同模式       | 可选系统、BootLoader、Recovery等 |
| 槽位功能   | 管理A/B槽位         | 刷机后必须"重设当前槽位"             |

**分区操作步骤：**

1. 在分区列表中，找到需要操作的分区（如`boot_a`）
2. 点击分区名称左侧的复选框，打上√
3. 点击分区右侧的"选择文件"按钮
4. 选择要刷入的镜像文件
5. 点击"刷入"按钮开始操作

**重要提示：**

- 如果只勾选分区但未选择文件，点击"刷入"不会对分区做任何操作
- 如果只选择文件但未勾选分区，不会执行任何操作
- 回读操作会覆盖选定的文件，请提前备份

## 二、刷写GKI Root详细步骤

### 2.1 准备工作

**需要下载的文件：**

1. **刷机工具**：`匣(0.4.2.0913-B).zip`
2. **引导文件**：`xbl_s_devprg_ns.melf`
3. **GKI内核镜像**：从群文件夹选择：
   - `KernelSU`文件夹：适合大多数用户
   - `KernelSU Next`文件夹：更新版本
   - 文件大小约96MB，扩展名为`.img`
4. **Root管理器APP**：与镜像对应的APK文件

### 2.2 进入9008模式的方法

**方法一：按键组合（适用于354版本前系统）**

1. 确保平板**完全关机**
2. 按住**音量上键**不放
3. 插入USB数据线连接电脑
4. 屏幕先显示充电图标，然后黑屏
5. 电脑发出设备连接提示音
6. 在设备管理器中看到`Qualcomm HS-USB QDLoader 9008`

**方法二：ADB命令（适用于所有版本）**

1. 在平板上开启USB调试：
   - 设置 → 关于平板电脑 → 连续点击"软件版本"直到提示"开发者模式已开启"
   - 设置 → 通用设置 → 开发者选项 → 开启"USB调试"
2. 连接电脑，在平板上允许USB调试
3. 电脑打开命令提示符，输入：`adb reboot edl`
4. 平板自动重启到9008模式

**方法三：工程线（救砖专用）**

1. 购买"二代高通工程线"
2. 平板关机状态下，按住工程线上的按键
3. 连接平板和电脑
4. 自动进入9008模式

**方法四：无法关机时的紧急方法**

1. 购买”二代高通工程线“

2. 将工程线的A端连接到电脑，Type-C端连接到平板

3. 电脑端打开设备管理器方便观察设备状态

4. 按住工程线上的按键、平板的电源键和音量减键，观察电脑上的设备管理器直到出现9008设备

### 2.3 刷写GKI Root具体操作

**步骤1：发送引导文件**

1. 打开刷机匣，进入"深度刷机"界面
2. 点击"选择设备/引导/配置"
3. 选择`xbl_s_devprg_ns.melf`文件
4. 点击"确定"

**步骤2：读取设备信息**

1. 点击"读信息"按钮
2. 等待日志显示读取成功
3. 分区列表会显示出来

*日志提示无法读取LUN6、LUN7和super分区的内容是正常的*

**步骤3：确定当前槽位**

1. 点击"槽位功能"按钮
2. 点击"查看当前槽位"
3. 记住显示的槽位号（A或B）

**步骤4：刷入GKI镜像**

1. 在分区列表中找到对应的boot分区：
   - 如果槽位是A：选择`boot_a`
   - 如果槽位是B：选择`boot_b`
2. 勾选该分区左侧的复选框
3. 点击分区右侧的"选择文件"
4. 选择下载的GKI镜像文件（如`boot-kernelsu.img`）
5. 点击"刷入"按钮
6. 等待进度条完成

**步骤5：重设槽位**

1. 刷入完成后，点击"槽位功能"
2. 点击"重设当前槽位"
3. 这是**必须步骤**，否则可能无法启动

**步骤6：重启设备**

1. 点击"重启"按钮
2. 选择"重启到系统"
3. 平板会自动重启

**步骤7：安装Root管理器**

1. 平板启动后，安装对应的Root管理器APP
2. 打开APP，检查Root状态
3. 显示"已安装"表示成功

### 2.4 注意事项

1. **不要使用"直接安装"**：Root管理器中可能有"直接安装"选项，**绝对不要使用**，会导致无法开机
2. **系统更新后**：如果更新了系统，需要重新进入9008刷入GKI镜像
3. **备份原镜像**：刷入前必须回读原boot分区备份

## 三、刷写LKM Root详细步骤

### 3.1 准备工作

**需要下载的文件：**

1. **LKM镜像包**：从群文件`KernelSU`文件夹下载
   - 文件名格式：`kernelsu_lkm_xxxx_版本号.7z`
   - 例如：`kernelsu_lkm_12123_326.7z`
   - **必须与当前系统版本匹配**
2. **解压文件**：解压后得到两个文件：
   - `init_boot.img`（已修补）
   - `vbmeta.img`（已签名）

### 3.2 操作步骤

**步骤1：备份原分区（重要！）**

1. 进入9008模式，发送引导文件
2. 确定当前槽位（A或B）
3. 勾选对应分区的`init_boot`和`vbmeta`：
   - A槽：`init_boot_a`、`vbmeta_a`
   - B槽：`init_boot_b`、`vbmeta_b`
4. 点击"回读"按钮
5. 选择保存位置（建议新建文件夹）
6. 等待回读完成，得到两个备份文件

**步骤2：刷入LKM镜像**

1. 确保仍在9008模式
2. 勾选`init_boot`分区（对应槽位）
3. 点击"选择文件"，选择解压的`init_boot.img`
4. 勾选`vbmeta`分区（对应槽位）
5. 点击"选择文件"，选择解压的`vbmeta.img`
6. 点击"刷入"按钮
7. 等待两个分区都刷写完成

**步骤3：后续操作**

1. 点击"槽位功能" → "重设当前槽位"
2. 点击"重启" → "重启到系统"
3. 安装对应的Root管理器APP
4. 检查Root状态

### 3.3 特殊情况处理

**如果之前使用GKI Root：**

1. 先刷回原版boot镜像：
   - 从备份或群文件"香香软软的原始BOOT文件"获取
   - 刷入对应槽位的boot分区
2. 重设槽位，重启确认Root已解除
3. 再按上述步骤刷入LKM

## 四、刷写第三方ROM或者原厂ROM详细步骤

### 4.1 准备工作

**需要下载的文件：**

1. **ROM包**：从群文件夹"刷机包"下载
   - 目前可用：ColorOS 15/16、HyperOS 2.0/3.0、截至354版本的原厂ROM
   - 文件为压缩包，解压后得到多个文件
2. **patch.xml文件**：如果ROM包内没有，下载群文件夹”刷机包“中的`patch_xml_官方297.zip`

### 4.2 刷机前注意事项

1. **数据会全部丢失**：刷机前备份所有重要数据
2. **无法互刷的系统**：
   - ColorOS 15和HyperOS 2.0不能互刷
   - 其他系统间刷机也有限制，遵循防回滚原则，高版本系统不能降级到低版本
3. **检查文件完整性**：正常ROM包应有50个以上镜像文件

### 4.3 详细刷机步骤

**步骤1：准备刷机包**

1. 下载ROM压缩包
2. 解压到单独文件夹，如`D:\ROM\ColorOS15\`
3. 如果包内没有`patch.xml`，将下载的patch文件也放入该文件夹

**步骤2：进入9008模式**

1. 平板进入9008模式（方法同前）
2. 打开刷机匣，发送引导文件
3. 点击"读信息"确认连接正常

**步骤3：加载刷机文件**

1. 在刷机匣界面，找到"选择XML"按钮
2. 点击后，浏览到ROM文件夹
3. 同时选中`rawprogram.xml`和`patch.xml`
4. 点击"打开"

**步骤4：检查文件加载**

1. 查看分区列表，确认每个分区都关联了正确的镜像文件
2. 如果文件路径显示不正确：
   - 点击"选择镜像目录"按钮
   - 选择ROM文件夹
   - 软件会自动重新关联

**步骤5：设置槽位**

1. 点击"槽位功能"
2. 查看当前槽位
3. **建议**：如果当前是B槽，点击"设为A槽位"
4. 等待槽位切换完成

**步骤6：开始刷机**

1. 确认所有分区都已正确关联文件
2. 点击"刷入"按钮
3. 等待进度条完成（USB3.0更快）
4. **不要中途断开连接**

**步骤7：刷机后操作**

1. 刷入完成后，点击"槽位功能"
2. 点击"重设当前槽位"
3. 点击"恢复出厂设置" → 选择"通用"
4. 平板会自动重启到Recovery

**步骤8：Recovery操作**

1. 平板进入Recovery后，使用音量键选择：
   - `wipe data/factory reset`（恢复出厂设置）
2. 按电源键确认
3. 进入二级菜单，再按一次音量下
4. 按电源键开始清除数据
5. 完成后返回主菜单
6. 选择`reboot to system`重启

### 4.4 特殊情况处理

**如果重启后只有两个选项：**

1. 按音量下键选择第一个选项
2. 按电源键确认
3. 再按一次音量下键
4. 按电源键确认
5. 自动执行恢复出厂

**如果卡在第二屏：**

1. 强制重启：电源键+音量下键
2. 黑屏后立即按住音量上键，进入Recovery
3. 手动执行恢复出厂设置

## 五、常见问题详细解答

### 5.1 9008模式相关问题

**Q：电脑检测不到9008设备？**
A：按顺序检查：

1. 换USB线或电脑USB口
2. 检查设备管理器是否有带感叹号的设备
3. 关闭Windows驱动程序强制签名：
   - Win10/11：设置 → 更新 → 恢复 → 高级启动 → 立即重启
   - 选择"疑难解答" → "高级选项" → "启动设置" → 重启
   - 按7或F7选择"禁用驱动程序强制签名"
4. 使用匣重新安装驱动

**Q：提示"Sahara协议握手失败"？**
A：忘记发送引导文件了，需要：

1. 强制重启设备（电源+音量下）
2. 重新进入9008模式
3. 先发送引导文件，再操作

### 5.2 刷机过程中的问题

**Q：刷机中途出错怎么办？**
A：

1. 不要拔线，先保存错误信息（复制或者截图，不建议拍摄屏幕）
2. 如果是单个分区错误，可以单独重刷该分区
3. 如果严重错误，用工程线强制进入9008
4. 刷入之前备份的镜像恢复

**Q：刷完后无法开机？**
A：

1. 检查是否执行了"重设当前槽位"
2. 检查刷入的镜像是否正确
3. 尝试进入Recovery执行恢复出厂
4. 如果都不行，用备份恢复

### 5.3 Root相关问题

**Q：Root后无法安装APP？**
A：

1. 检查是否登录了Google账号，尝试退出
2. 如果使用SukiSU，换用KernelSU
3. 多次重启尝试
4. 使用ADB命令安装：`adb install 应用路径`，例如`adb install F:\myAPK.apk`

**Q：想换Root管理器怎么办？**
A：

1. 必须先解除当前Root
2. 重新刷入原版分区
3. 再刷入新Root管理器的镜像
4. **不能直接切换**

### 5.4 其他实用技巧

**强制重启组合键**：

- 电源键 + 音量下键：任何情况下都能强制重启

**进入安全模式（KernelSU、KernelSU Next、SukiSU Ultra）**：

- 卡在第一/二屏时，快速按3次音量下键
- 会停用所有模块，用于排查模块问题

**ADB安装应用**：

- 命令：`adb install D:\应用名.apk`
- 避免系统安装器崩溃问题

## 六、重要安全提醒

1. **必须备份**：刷机前一定要备份底层分区
2. **准备工程线**：建议购买备用，救砖时必需
3. **仔细核对**：刷入前确认分区和文件对应正确
4. **不要冒险**：不确定的操作先询问，不要盲目尝试
5. **保留原系统**：建议保留官方系统备份，方便恢复

## 七、获取帮助

如果按照以上步骤仍无法解决问题：

1. 先查看"常见问题速查"部分
2. 在群内提问时，提供：
   - 你做了什么操作
   - 当前的具体现象
   - 已经尝试的解决方法
3. 最好提供截图或错误信息

记住：刷机有风险，操作需谨慎。祝您刷机顺利！
