## 酷安Pad Pro GT交流群 文档

本文档是群聊“酷安Pad Pro GT交流群”的技术文档的第二部分。

文档适用于TB710FU，也就是“联想小新Pad Pro GT”或者“Lenovo Xiaoxin Pad Pro GT”。

<a name="part8"></a>

## 8、 刷写GKI Root

**如果碰到任何不确定的内容，请参考上面对于刷机工具“匣”的使用教程**

GKI Root对于官方和第三方ROM都适用。

> 警告：搞机有风险，流程无问题，请严格比对操作，变砖莫找群友背锅。
> 
> 强烈建议您准备一条“二代”工程线，一旦需要救砖时有大用。
> 
> 如果任何步骤遇到问题，请先参考[<b><sub>这里</sub></b>](hprfq6#Part13)（条目13），实在无法解决再向群友提问。

自己下载群文件夹中合适的文件：

* 刷机工具：刷机匣，位于“搞机工具”文件夹中；

* Boot镜像（GKI内核）：建议选择KernelSU或者KernelSU Next文件夹中的镜像（单个镜像大小约为96MiB）。

* Root管理器：根据你使用的boot镜像自行选择。

设备关机，按音量上键，插入数据线。先是出现电池标，后屏幕直接黑掉，电脑发出设备插入提示音，设备管理器显示有9008就说明进入9008模式成功。

*对于ZUXOS 1.1.04.354及以后的版本，请使用ADB命令adb reboot edl进入9008，或者购买二代高通工程线*

打开刷机匣，点击选择设备引导配置，选择引导文件`xbl_s_devprg_ns.melf`，然后读取设备分区

按槽位功能-查看当前槽位来确定槽位（记住这个槽位号，不同批次设备槽位可能不同，看到是哪个槽位等会就刷哪个槽位的boot）

然后在对应分区名（A槽为`boot_a`, B槽为`boot_b`）后面点击选择文件,选择刚才下载的boot镜像

点击基础操作栏目中的刷入，将`boot镜像`烧录到平板中。刷入完成后，点击“槽位功能”按钮展开菜单，然后点击“重设当前槽位”。

开机后安装和所用镜像匹配的Root管理器，完成全流程。

**注意：不要想着通过管理器中的“直接安装”更新Root实现版本！**

<a name="part9"></a>

## 9、 刷写LKM Root

**如果碰到任何不确定的内容，请参考上面对于刷机工具“匣”的使用教程**

> 警告：搞机有风险，流程无问题，请严格比对操作，变砖莫找群友背锅。
> 
> 强烈建议您准备一条“二代”工程线，一旦需要救砖时有大用。
> 
> 如果任何步骤遇到问题，请先参考[<b><sub>这里</sub></b>](hprfq6#Part13)（条目13），实在无法解决再向群友提问。

自己下载群文件夹中合适的文件：

* 刷机工具：刷机匣，位于“搞机工具”文件夹中；

* 镜像文件压缩包（带LKM字样）：选择KernelSU文件夹中的7z文件（单个压缩包大小为10MiB以内），并请注意文件末尾的版本号数字，您应当使用与自己的平板当前运行的ZUXOS版本号一致的文件；

* Root管理器：根据你使用的镜像自行选择。
1. 作者设备运行的ZUXOS版本为326，因此下载群文件中的`kernelsu_lkm_12123_326.7z`。把其中的文件解压缩到方便找到的目录，例如D:\LKM

2. <a name="解除root-gki"></a>现在将设备重启到9008模式：关机，按住音量加，并插入数据线，设备应当先显示充电符号，并在几秒钟后黑屏，且电脑发出插入设备的提示音。这时可以松开音量键，准备在电脑端发送引导。*对于ZUXOS 1.1.04.354及以后的版本，请使用ADB命令adb reboot edl进入9008，或者购买二代高通工程线*

        如果遇到问题，请参考常见问题解答， 它列出了较为完整的进入9008模式的方法。

        发送引导方式：

* 点击“选择设备/引导/配置”

* 在弹出的窗口中，点击“引导文件”处右侧的“…”按钮，并在弹出的对话框选择从群文件夹“神秘引导文件”下载的`xbl_s_devprg_ns.melf`文件，并点“打开”选择它，最后在刷机匣的对话框点击确认

* 现在回到刷机匣的主界面，点击“读信息”，确认一下设备连接是否正常，如果正常，应当能够读取到分区信息。

3、如果您此前未使用GKI镜像进行Root，请跳转到步骤4；反之，请跟随本步骤操作。

* 使用工具箱的“槽位功能/查看槽位”确认活动槽位，记住槽位号。

* 如果槽位为A，找到`boot_a`分区，反之，找到`boot_b`分区，并勾选分区前的复选框，然后选择之前备份的原`boot分区文件`，如果没有备份，可以尝试群文件夹“香香软软的原始BOOT文件”中的内容，请同样注意槽位号

* 现在，点击“刷入”，恢复原始的`boot镜像`，刷入完成后，点击“槽位功能”按钮展开菜单，然后点击“重设当前槽位”

* 完成后重启设备至系统，确认Root管理器中工作状态变为“未安装”即完成恢复步骤

4、现在可以准备正式刷入`vbmeta`和`init_boot`了，先**备份对应分区。**

*如果您刚刚完成步骤3，请按步骤2方法重新将设备重启至9008模式并发送引导，然后继续操作。*

勾选对应槽位的`init_boot`和`vbmeta`分区（不要弄错分区名称和槽位，槽位查看方法请参考步骤3）后，按右侧的回读按键从设备读出分区，记得选择容易记忆且有区分度的目录，例如作者选择将回读的文件存储在`D:\LKM\Readback`中

5、正式刷入`init_boot`和`vbmeta`，为两个分区选择对应的、已经过Root管理器修补并签名的文件，并点按刷入按钮，完成后重启到系统

6、设备应当正确启动。启动后安装合适的Root管理器（例如作者使用KernelSU LKM, 那么安装KernelSU），应当看到管理器显示当前工作在LKM模式下，如下图所示

恭喜您，到此已经完成了使用LKM镜像进行Root的全部流程。请妥善保存回读镜像，并尽情享受Root吧！

**注意：不要想着通过管理器中的“直接安装”更新Root实现版本！**

<a name="part10"></a>

## 10、 我是真不知道怎么解除Root……

要解除Root就要做的干净，不要在`/data`目录下残留任何垃圾，以KernelSU为例，先跟随接下来的步骤处理这项工作：

1. 首先在KernelSU的模块页面关闭所有模块，然后重启一次平板。

2. 重启完成之后，点击KernelSU主页左上角的**设置**，然后找到**最小化稀疏文件**选项，点击并确认。

3. 上面的步骤搞定之后，KernelSU的模块镜像会被缩小到最小体积
   
   * 为什么能够最小化这个文件？KernelSU官方文档是这么说的：

> Q: 为什么有个1TB的超大文件？
> 
> A: 1 TB 大小的 `modules.img` 是一个磁盘镜像文件，不要担心它的大小，它是一种被称之为稀疏文件的文件格式，它的实际大小只有你使用的模块的大小，并且你在删除模块后它会动态缩小；它并不实际占用 1 TB 大小的磁盘空间（实际上你手机可能并没有这么多空间）。 如果你真的对这个文件的大小感到不爽，你可以使用 `resize2fs -M`命令让它变成实际大小；但此时模块可能无法正常工作......

4. 使用*MT管理器*等能够获取Root并读写`/data`的文件管理器访问`/data`，能看到一个名为adb的文件夹。如果不需要保留模块和APP Profile，直接删除这个文件夹；反之，将文件夹*剪切*到内置存储空间中容易记忆的目录。**完成后不要再打开Root管理器！一旦打开又会重新创建adb文件夹！**

5. 现在可以让平板进入9008模式刷写原厂镜像了。解除Root的刷写过程和Root的过程异曲同工，但是需要刷入自己设备的原始镜像。对于GKI，应当刷回`原始boot镜像`；对于LKM，则应当刷入`原始init_boot`和`原始vbmeta镜像`。具体的刷入过程在此不表，你应当参考上面的“刷写GKI Root”和“刷写LKM Root”。
   
   * 如果找不到`原始boot镜像`，群文件夹“香香软软的原始BOOT文件”内可以找到。如果是`init_boot`和`vbmeta`，请尝试寻找群友贡献。如果您希望提供原始镜像，请直接上传到群中，群主和管理员会在看到后帮你移动到正确的文件夹。
   
   * [这里](#解除root-gki)有一个详细案例，阐述了如何解除GKI模式的Root。LKM版本刷回原版镜像的分区为`init\_boot`和`vbmeta`，其他步骤和这个案例相同。

6. 刷写完成之后，如果你重新进行了Root并且**先前备份了adb文件夹**，将它移动回原来的位置就行。移动时，如果提示文件冲突，**全部覆盖**。

<a name="part11"></a>

## 11、 刷入第三方ROM

**如果碰到任何不确定的内容，请参考上面对于刷机工具“匣”的使用教程**

刷入第三方ROM无法保留用户数据！

由于无法解锁BootLoader，目前的刷机包均以9008刷机包形式提供，并且都是从设备存储内回读制成的。**如果你发现了文件数量明显偏少（少于50个）的包，立马停用**。

目前为止，小新Pad Pro GT总共可以运行五个系统：ZUXOS, ColorOS 15, HyperOS 2.0, ColorOS 16, HyperOS 3.0。

这五个系统中，ColorOS 15和HyperOS 2不能互刷，如果强行在ColorOS 15和HyperOS 2.0之间互刷，将触发AVB2.0校验错误。

无论是刷第三方系统、回到原系统或者救砖，均遵循以下步骤：

1. 平板进入9008模式，电脑安装好刷机驱动，解压刷机包并放在一个合适的位置。打开匣，选择引导文件，用“读信息”按钮确定设备和引导文件状态正常。如果你不知道以上任何一步的内容，跳转到 [这里](#part7) 来学习。

2. 在匣的主页面，找到“选择XML”按钮。点击打开二级页面。

3. 在打开的二级页面中，找到你解压刷机包的目录，里面应当存在这些`rawprogram.xml`和`patch.xml`，将它们全部选中，并点击打开：
   
   * 如果没有`patch.xml`，从群文件夹“刷机包”中下载`patch_xml_官方297.zip`后解压到刷机包所在文件夹中，然后在匣选中`rawprogram.xml`和`patch.xml`即可

4. 打开之后检查匣是否正确加载了镜像文件，尤其对于“刚刚备份好，准备直接开始刷写ROM的用户”，请手动检查匣选定的镜像到底是**刚刚回读的镜像**还是**等待刷入的镜像**

5. 如果镜像文件路径不正确，用“选择XML”按钮右侧的“选择镜像目录”手动指定镜像的存储位置

6. 现在点击界面上的“槽位功能”，看看你的槽位。如果为B，最好先点击“槽位功能”中的“设为A槽位”再行操作。现在可以开始刷机了，点击主界面上的“刷入”按键，耐心等待进度条走完。*// 使用USB3传输效果更佳*

7. 进度条走完后，点一次“重设当前槽位”

8. 最后，点击“恢复出厂设置”中的“通用”，平板会自动重启到Recovery模式。

9. 在Recovery模式中，用音量键找到`wipe data/factory reset`，也就是恢复出厂，然后按电源键确认。进入二级菜单后，再按一次音量下，然后按电源键，就完成了恢复出厂操作。

10. 如果你不清楚Recovery模式的操作，跳转到 [这里](#part4) （条目4）进行学习。

11. 现在应当回到了主界面，选择`reboot to system`，重启到Android系统。至此完成刷机操作。

12. 你也可能会重启到一个只有两个选项的页面。这样的话，只需要重复两次“按下音量下->按下电源键”，就能恢复出厂设置。也就完成刷机操作了。

13. 如果过程中出现了任何意外，或者想回到原版系统，参照本教程刷入你的备份即可。如果没有备份，自己想办法。

<a name="part12"></a>

## 12、 常见问题速查[Appendix 1]

**问1：** **怎么进入9008模式？**

答：共有以下几种办法：

1、使用PC端工具重启至9008，需要平板能正常启动至操作系统，并保证USB调试状态正常（可能需要在平板上将USB用法设置为**仅充电**方可正常使用USB调试）；

2、使用adb命令重启至9008模式，需保证设备能正常启动至操作系统，并保证USB调试状态正常。具体的命令为`adb reboot edl`

3、**关机**状态下使用按键（354及更高版本系统无效）：确保设备**完全关机**，然后按住音量+不放，随后插入USB线，设备应当先亮起充电符号，然后灭屏，随即进入9008模式。此时电脑上应当能够检测到9008端口；

4、使用工程线，各大电商平台均有售，请务必认准“二代”字样，这标志着这些线内置了一个小阻值电阻，适合骁龙855及以后机型使用。

* 用法：确保平板**完全关机**，**按住工程线上的按键**并连接平板，即可进入9008模式。

* 如果平板重复进入900E模式或者卡在`Bootloader`（通常更常称为Fastboot），先将工程线连接到电脑，另外一头插平板，然后同时按住**平板的电源键**、**平板的音量下键**以及**工程线上的按键**，等一会后平板黑屏，设备管理器就会显示9008端口，标志进入9008成功。

*\*所有方法已测试可用，如果仍旧遇到问题请参考下一问。*

**问2：*按照上一问方法操作后*，电脑没有识别到9008端口，应当怎么做？**（最常被提及的问题）

答：请依次检查以下项目：

1. 检查您的USB线和可能使用的集线器/转换器，看看连接其他手机/平板时是否能正常工作？

2. 驱动程序是否已正确安装？如果已经安装，并且设备管理器中的“端口（COM和LPT）”一项中曾存在带感叹号的9008设备，且双击设备后，能看到详细信息中提示“代码52”，请关闭电脑的“驱动程序强制签名”*[注释1]* 或者换用匣提供的9008驱动。

3. 设备是否已经完全关机？使用组合键“电源+音量减”强制重启设备。

4. 如果以上任何措施均无法解决问题，找售后解决，由于BootLoader没有解锁，设备仍旧拥有免费保修的资格。

**问3: “与Sahara协议握手失败，重置设备状态”，这是什么情况？**

答: 忘记发送引导了，参考下一问来修正这个问题。

**问4： 9008刷机出错后（例如忘记发送引导），如何强制重启到其他操作模式，如fastboot？**

答：无需断开和电脑的连接，请按住电源键和音量-键，即可强制重启，令设备退出9008模式。稍后即可通过组合键进入Fastboot, Recovery或系统。

作者注： **电源+音量减**是通用的强制重启按键，可以解决99%的“我的平板黑屏了，怎么办”类问题

**问5：** **我可能在9008刷机时刷入了错误的内容，导致平板无法正常工作，我应当怎么做？**

答：没必要每逢变砖就刷入全分区备份。请用刷入之前提取的备份分区镜像依次对应刷入被修改的分区，以恢复它们至原来的状态，请参考问1和问3以重新进入9008模式。

**\*请保持观察设备管理器，如果Windows提示有900e设备连接，说明设备分区受到了严重损坏，且此时按键组合很可能无法令设备进入9008模式。请使用工程线强制进入9008模式，通过刷入备份的镜像恢复设备。**

**\*如果你没有备份，恭喜你，你死了。**

**问6：** **应当向哪个槽位刷入群内的boot镜像，以实现Root？**

答：你需要先确定活动槽位。

方法1：将平板重启到fastboot模式（对应的adb命令为adb reboot bootloader）使用命令“fastboot getvar current-slot”获取活动槽位，向活动槽位的boot分区刷入即可。如果实在不放心，**同时刷入ab两个槽位也是可行的。**

方法2：重启到9008模式，在刷机匣中配置好引导，利用“槽位工具->获取当前槽位”得到槽位号。

例：获取到当前活动槽位为b，则在高通工具箱中，发送引导后选择“刷入单个分区”，并填写分区名为”boot\_b”，选择镜像刷入。或者在匣中配置好引导，勾选boot\_b分区，并选择boot分区文件刷入。

**\*对于LKM方法，刷入init\_boot和vbmeta时用同样的方法确定槽位。**

**问7：** **群文件内的几个GKI内核文件应当如何选择？**

答：建议选择KernelSU或KernelSU Next对应的内核文件。使用SukuSU Ultra可能会碰到无法安装APP的情况，需要等待上游提供修复补丁。

**问8：** **Root后，刷入模块有何需要注意的事项？**

答：正常刷入即可，**但解除Root之前必须关闭或者卸载模块。**

**问9：** **当前流行的调度优化模块、线程放置模块和scene能否使用？**

答：Uperf已更新，支持了六核骁龙8 Gen 3.可以正常使用。但不建议安装其附带的A-SOUL线程优化。Scene本体可用，但是不能使用其附带的调度。

**问10：** **更新系统或者刷写第三方ROM后还能使用同样的方法获取root吗？刷入root后是否会导致系统更新安装失败？**

答：可以，Android的内核是可拆装的（在GKI 2.0铺开后这一点更容易被玩机用户感知到），只要Android仍支持此版本的Linux内核且联想不封堵此方式*[注释3]*，那么理论上群文件里的GKI内核都能使用。但是，您必须使用电脑通过9008模式刷入，**切莫使用各大root管理器中内置的普通OTA方法，会导致设备更新后无法开机。**

**问11：** **为何我在获取Root权限后无法安装新的应用程序，或提示软件包管理程序已停止运行？**

答：如观察到此问题，请依次做以下检查：

1. 您是否在刷机前没有退出Google账号？如果是，请擦除frp分区或者登出谷歌账号；

2. 如果您使用群文件夹SukiSU中的GKI内核，请尝试更换KernelSU (Next)文件夹中的内容来Root设备，后者根据现有报告明显更加稳定；

3. 如果问题仍旧无法解决，请多次重启设备，并在每次重启后重新尝试安装。

4. 系统安装器偶有崩溃现象，可以试试使用adb命令进行安装用法：`adb install <file_directory>`示例：`adb install D:\MyFile\KernelSU.apk`

**问12：** **现在有处于“可用“水平的第三方系统吗？**

答：ColorOS 15、HyperOS 2.0、ColorOS 16以及HyperOS 3.0，如有需要请在群文件夹“刷机包”中自取，教程请看本文档前面的部分。

所有系统的bug请看对应的链接文档。

**问13： 我可以切换到我喜欢的root管理器吗？**

答：如果你没有为生成的`boot`或者`init_boot`文件重新签名的能力，请勿这样做。强行刷入不被BootLoader认可签名的镜像将导致平板无法开机。

**问14：** **我卡在了fastboot模式，我应当怎么做？**

答：通常是因为设备当前所处槽位不正确。依次尝试以下项目：

1. 在fastboot中尝试找到选项`Boot to Alternate Slot`，按电源键确认。（多半是找不到的）

2. 令设备进入9008模式，使用匣中的“槽位工具->重设当前槽位”后重启设备。

**问15：我卡在了第一/第二屏，救我！**

如果是KernelSU刷入模块后卡第一或者第二屏，按照以下步骤操作：

1. 同时按下电源和音量下，直到设备黑屏后松开

2. 当Logo亮起时，至少快速按3次音量下，KernelSU（及其分支）会进入安全模式，停用所有模块，现在应当能够进入系统桌面

3. 打开你的Root管理器，卸载有问题的模块

Magisk应该也有类似的安全机制，请自行寻找文档。

无论如何，建议提前准备“神仙自动救砖”等模块。

如果是刷入第三方系统后在第一次开机时卡第二屏，说明恢复出厂这步存在问题，刷回原系统或放弃数据并按照以下步骤操作：

1. 同时按下电源和音量下，直到设备黑屏后松开

2. 立刻再按下音量上，也就是电源、音量下、音量上三个按键同时按下，设备应当进入了Recovery模式

3. 用音量键切换选项到正数第七个，也就是“Wipe data/ factory reset”，按电源键确认，进入二级菜单

4. 在二级菜单中，按一次音量下，将光标移动到第二个选项，按电源键确认

5. 现在系统会自动执行恢复出厂，并返回Recovery主界面。按电源键就能执行光标目前位于的“Reboot to system”选项，成功启动三方系统。

*第五步中系统自动恢复出厂时，你可能会看到以下两条错误日志：*
    ERROR: logwrapper: Cannot log to file /data/fscklogs/log

    ERROR: recovery: Open failed: /metadata/ota: No such file or directory

这些是正常的，无需理会。

**问16：欸，怎么我ADB命令全报错了？怎么执行了之后没反应？**

先看看ADB和fastboot工具是不是没装上，[这里](#安装adb)有详细的ADB安装步骤。

如果ADB正常，检查一下命令是否错误，再看看USB连接是否正常。

**注释1：** 如何关闭Windows的“驱动程序强制签名“？

Windows 10: 打开设置，进入“Windows更新->恢复->高级重新启动“，并左键点击立即重启。在稍后弹出的页面依次选择”疑难解答->启动设置（更改Windows的启动行为）->重启“，并在稍后用数字键或F1到F12选择”禁用驱动程序强制签名“

Windows 11: 打开设置，进入“Windows更新->高级选项->恢复->高级重新启动”，弹出确认对话框并选择立即重启后，进入和Windows 10类似的蓝色页面，同样选择“疑难解答->启动设置”，并参考上述适用于Windows 10的步骤来关闭驱动程序强制签名。

**注释2：** 免解锁BootLoader并Root依赖于联想的签名漏洞，修改其他分区文件的模块将触发BootLoader的“签名校验错误”异常。

**注释3：** 高通处理器的熔丝（QFUSE，更通用的说法为eFUSE）可以被运行在TEEOS的程序修改，在后续系统更新里联想可能通过此方式禁止普通用户将设备启动到9008 模式。
