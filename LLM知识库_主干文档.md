# 技术文档概述

本文档适用于TB710FU设备（联想小新Pad Pro GT / Lenovo Xiaoxin Pad Pro GT）。

## 主要内容

### 如果我啥都不会/我纯小白？

引导新手用户建立正确的学习态度，鼓励自行研究技术内容和阅读群公告中网页链接指向的文档。

如果用户对计算机基础操作有疑问，推荐学习网址：[你缺失的那门计算机课](https://www.criwits.top/missing/)

### 提问的智慧

有效提问应包含三个要素：先前操作、当前症状、期望目标。避免模糊描述，提高问题解决效率。

### 完整的刷写本设备的流程

概述刷机基本流程：

1. 进入9008模式
2. 刷入文件，如KernelSU GKI：下载对应内核镜像，使用9008工具刷入。
3. 核心要点：刷写修改镜像；Root通过修改内核镜像实现。

### 术语

- **9008模式**：高通设备应急下载模式，用于底层刷机，需先发送引导文件（Firehose）。
- **900E模式**：设备严重故障模式，需通过工程线等强制进入9008修复。
- **回读（ReadBack）**：从设备存储中读取文件备份。
- **槽位（Slot）**：Android设备的A/B分区系统，用于系统更新和Failsafe。
- **关键分区**：
  - `init_boot`：Ramdisk分区，LKM Root需修补。
  - `boot`：Linux内核分区，GKI Root需替换。
  - `vbmeta`：AVB验证信息分区，LKM Root需替换。
  - `super`：动态分区，包含`system`、`vendor`等。
- **Root方案**：
  - **GKI（通用内核映像）**：直接替换内核，泛用性好，可以为TB710FU的所有系统使用。
  - **LKM（可加载内核模块）**：修补`init_boot`实现Root，但需同步刷入`vbmeta`，操作更复杂。
- **ADB**：Android调试桥，用于与处于操作系统或者恢复模式的设备通信。
- **AVB2.0**：Android验证启动，防止运行未经授权的内容。
- **Fastboot/Fastbootd**：引导加载程序，用于刷写分区。
- **Recovery**：系统恢复模式，用于安装更新、清除数据等。
- **第一屏/第二屏**：启动界面，卡住可能表示内核或系统配置问题。

### 刷机工具教程——匣

目前主流刷机工具，界面友好，功能集成度高：

- 安装驱动后，进入”高通/QC“页签下的”深度刷机“界面。
- 需先选择引导文件（如`xbl_s_devprg_ns.melf`）。
- 支持通过XML刷机、分区回读、擦除、重启等功能。
- 刷机完成后需使用“槽位功能”重设当前槽位。

### 进行任何刷机操作之前我应当怎么做？

1. **准备工具**：下载ADB工具、刷机匣、引导文件。

2. **安装驱动**：使用匣工具安装刷机驱动。

3. **备份底层分区**：通过9008模式回读全分区及分区表。

4. **备份用户数据**：如有Root权限可使用”数据备份“APP，否则需另寻方法。

### 关于两种Root方案的解析

- **GKI模式**：直接替换内核，操作简单，防检测能力较强，兼容性好。
- **LKM模式**：需修补`init_boot`和`vbmeta`，系统更新后需重新处理，工作量大。
- **建议**：本设备推荐使用GKI模式，因LKM维护难度更大，难以跟随系统更新节奏。

### 刷写GKI Root

步骤：

1. 下载刷机匣、GKI内核镜像、Root管理器。
2. 设备进入9008模式（ADB命令 `adb reboot edl`）。
3. 在匣中选择引导文件，读取分区信息。
4. 确定当前槽位，刷入对应槽位的`boot`镜像。
5. 刷入后重设当前槽位，重启安装Root管理器。
6. **注意**：切勿通过管理器“直接安装”功能更新Root。

### 刷写LKM Root

步骤：

1. 下载对应系统版本的LKM镜像包。
2. 进入9008模式，发送引导文件。
3. 备份原`init_boot`和`vbmeta`分区。
4. 刷入修补并签名后的`init_boot`和`vbmeta`文件。
5. 重启安装Root管理器。
6. **注意**：切勿通过管理器“直接安装”更新Root。

### 解除Root

1. 在Root管理器中关闭所有模块，重启设备。
2. 在KernelSU中最小化稀疏文件。
3. 删除或移动`/data/adb`文件夹。
4. 进入9008模式，刷回原版分区镜像（`boot`或`init_boot`+`vbmeta`）。
5. 如需保留模块配置，可将`adb`文件夹移回，然后刷写或者移除任何一个模块。

### 刷入第三方ROM

1. 设备进入9008模式。
2. 在匣中加载刷机包的`rawprogram.xml`和`patch.xml`。
3. 检查镜像文件路径是否正确。
4. 确认槽位，建议设置为A槽后刷入。
5. 刷入完成后重设当前槽位，执行恢复出厂设置。
6. 重启进入新系统。
7. **注意**：刷机前务必备份，刷机过程会清除所有数据。

### 常见问题速查

- **进入9008模式**：ADB命令`adb reboot edl`、按键组合（仅限354系统以下）、工程线（关机 -> 按住按键上的按钮 -> 插线）等方法。
- **电脑未识别9008端口**：检查USB连接、驱动安装、驱动程序签名、设备关机状态。
- **Sahara协议握手失败**：未发送引导文件，需重新进入9008模式后重新发送。
- **强制重启**：电源键+音量下键。
- **刷机出错**：刷入备份镜像恢复，严重损坏需用工程线。
- **确定刷机槽位**：通过Fastboot命令`fastboot getvar current-slot`或匣的槽位功能查看。
- **GKI内核选择**：建议KernelSU或KernelSU Next，SukiSU Ultra可能存在安装问题。
- **Root后模块注意事项**：解除Root前需卸载模块。
- **系统更新后Root**：仍可通过9008刷入GKI内核，切勿使用Root管理器的更新功能。
- **无法安装应用**：检查Google账号是否登出、擦除frp分区、更换Root方案、使用ADB安装。
- **第三方系统可用性**：ColorOS 15/16、HyperOS 2.0/3.0等，详见群文件。
- **切换Root管理器**：需使用群内预处理好的镜像或者重新签名镜像，否则可能导致无法开机。
- **卡在Fastboot模式**：尝试切换槽位或重设槽位。
- **卡在第一/第二屏**：进入Root实现提供的安全模式停用模块、解除Root、或者直接恢复出厂设置。
- **ADB命令报错**：检查ADB安装和USB连接。

## 重要提醒

- 刷机有风险，操作前请备份全分区镜像。
- 建议准备工程线以备救砖。
- 文档内容随技术发展可能更新，请以群公告中的链接内容为准。
